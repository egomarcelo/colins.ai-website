<section class="relative py-16 bg-background-3 dark:bg-background-6 overflow-hidden">
  
  <div class="main-container flex flex-col gap-4 h-full">
    
    <div class="flex flex-col items-center text-center gap-y-4">
      <h2 class="max-w-[750px] mx-auto" data-i18n="deeptech.animation.title">How it works</h2>
      <p class="max-w-[850px] text-secondary/70 dark:text-secondary-light/70" data-i18n="deeptech.animation.description">
        Stop burning cash on failed batches. We combine the reliability of high quality solvers (PyBaMM/FEniCS) with the speed of Neural Networks. We deliver a custom, pre-trained Digital Simulator calibrated to your specific chemistry.  
      </p>
    </div>
    <!-- Interactive Simulation Container -->
    <div data-ns-animate data-delay="0.4" class="w-full">
      <div id="dendrite-simulation-container" class="w-full min-h-[500px]"></div>
    </div>

  </div>
</section>

<!-- Scoped Styles for Dendrite Simulation -->
<style>
  /* ================================================== */
  /* DENDRITE SIMULATION STYLES */
  /* ================================================== */
  
  #dendrite-simulation-container {
    position: relative;
    width: 100%;
    min-height: 500px;
  }

  /* Control Panel Styles */
  .dendrite-control-panel {
    background: #ffffff;
  }

  .dark .dendrite-control-panel {
    background: #1a1a2e;
    border-color: #2d2d44;
  }

  /* Slider Track Styles */
  .slider-control input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    border-radius: 4px;
    outline: none;
    cursor: pointer;
  }

  .slider-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #3B82F6;
    cursor: pointer;
    border: 3px solid white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }

  .slider-control input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
  }

  .slider-control input[type="range"]::-webkit-slider-thumb:active {
    transform: scale(1.05);
  }

  .slider-control input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #3B82F6;
    cursor: pointer;
    border: 3px solid white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s ease;
  }

  .slider-control input[type="range"]::-moz-range-thumb:hover {
    transform: scale(1.1);
  }

  /* Metrics Cards */
  .metric-card {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Physics Info Box */
  .physics-info-box {
    background: #F0F9FF;
    border: 1px solid #BAE6FD;
  }

  .dark .physics-info-box {
    background: rgba(14, 165, 233, 0.1);
    border-color: rgba(14, 165, 233, 0.3);
    color: #7DD3FC;
  }

  /* Risk Gauge Animation */
  .risk-gauge-fill {
    transition: width 0.5s ease-out, background 0.3s ease;
  }

  /* Annotation Styles */
  .annotation {
    z-index: 100;
    transition: opacity 0.3s ease;
  }

  .annotation-warning {
    background: #FEF3C7;
    border-color: #F59E0B;
    color: #92400E;
  }

  .annotation-danger {
    background: #FEE2E2;
    border-color: #EF4444;
    color: #991B1B;
  }

  .annotation-success {
    background: #D1FAE5;
    border-color: #10B981;
    color: #065F46;
  }

  /* Mobile State Indicator */
  .mobile-state-indicator {
    z-index: 50;
  }

  /* Canvas Container */
  .dendrite-canvas-container {
    position: relative;
    background: #F9FAFB;
    border-radius: 0 16px 16px 0;
  }

  .dark .dendrite-canvas-container {
    background: #0f0f1a;
  }

  /* Responsive Adjustments */
  @media (max-width: 767px) {
    .dendrite-control-panel {
      display: none;
    }
    
    .dendrite-canvas-container {
      border-radius: 16px;
    }
    
    .dendrite-metrics-overlay {
      top: 12px;
      right: 12px;
    }
    
    .metric-card {
      padding: 10px 12px;
      min-width: 120px;
    }
    
    .penetration-value {
      font-size: 1.25rem !important;
    }
  }

  @media (min-width: 768px) {
    .dendrite-layout {
      display: flex;
      flex-direction: row;
    }
    
    .dendrite-control-panel {
      width: 280px;
      min-width: 280px;
      border-radius: 16px 0 0 16px;
    }
    
    .dendrite-canvas-container {
      flex: 1;
    }
  }

  /* Hover States for Interactive Elements */
  .slider-control:hover .slider-value-pressure,
  .slider-control:hover .slider-value-roughness {
    color: #2563EB;
  }

  /* Focus States for Accessibility */
  .slider-control input[type="range"]:focus {
    outline: none;
  }

  .slider-control input[type="range"]:focus-visible::-webkit-slider-thumb {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3), 0 2px 6px rgba(0,0,0,0.2);
  }

  /* Loading State */
  #dendrite-simulation-container:empty::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid #E5E7EB;
    border-top-color: #3B82F6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: translate(-50%, -50%) rotate(360deg);
    }
  }

  /* Annotation Fade Animation */
  @keyframes annotationPulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }

  .annotation-danger {
    animation: annotationPulse 2s ease-in-out infinite;
  }

  /* Smooth Scrolling for Panel */
  .dendrite-control-panel {
    scrollbar-width: thin;
    scrollbar-color: #CBD5E1 transparent;
  }

  .dendrite-control-panel::-webkit-scrollbar {
    width: 6px;
  }

  .dendrite-control-panel::-webkit-scrollbar-track {
    background: transparent;
  }

  .dendrite-control-panel::-webkit-scrollbar-thumb {
    background-color: #CBD5E1;
    border-radius: 3px;
  }

</style>